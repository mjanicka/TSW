<!DOCTYPE html>
<html>
    
    <head>
        <meta charset="UTF-8">
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
        <script type="text/javascript" src="http://localhost:8081/socket.io/socket.io.js"></script>
        <script type='text/javascript'>
            var downX;
            var downY;
            var ismousedown = 0;

            function mousedown(event) {
                var canvas = document.getElementById("mojCanvas");
                var context = canvas.getContext('2d');
                var kolor = document.getElementById("kolor");
                var figura = document.getElementById("figura");
                var x = event.clientX;
                var y = event.clientY;

                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;

                downX = x;
                downY = y;

                context.beginPath();

                if (kolor.value) {
                    context.strokeStyle = kolor.value;
                }

                if (figura.value == "punkt") {
                    context.rect(x, y, 2, 2);
                    context.stroke();
                }

                ismousedown = 1;
            }

            function mousemove(event) {
                if (ismousedown == 1) {
                    var canvas = document.getElementById("mojCanvas");
                    var context = canvas.getContext('2d');
                    var figura = document.getElementById("figura");
                    var x = event.clientX;
                    var y = event.clientY;

                    x -= canvas.offsetLeft;
                    y -= canvas.offsetTop;

                    if (figura.value == "punkt") {
                        context.rect(x, y, 2, 2);
                        context.stroke();
                    }
                }
            }

            function mouseup(event) {
                ismousedown = 0;

                var canvas = document.getElementById("mojCanvas");
                var context = canvas.getContext('2d');
                var figura = document.getElementById("figura");
                var x = event.clientX;
                var y = event.clientY;
				var radius = x - downX;	
                x -= canvas.offsetLeft;
                y -= canvas.offsetTop;

                switch (figura.value) {
                case "prostokąt":
                    context.rect(downX, downY, x - downX, y - downY);
                    context.stroke();
                break;
                
                case "koło":
					context.arc(downX, downY, radius, x, y, false);
					context.stroke();
				break;
				
				case "linia":
					context.moveTo(downX, downY);
					context.lineTo(x , y);
					context.stroke();
				break;
                }
            }

            function doserwera(text) {
                var socket = new io.connect('http://localhost:8081');

                socket.on('connect', function () {
                        socket.send(text);
                    });
            }


            function wyslij() {
                var tekst = document.getElementById("wiadomosc");
                var poleczat = document.getElementById("czat");

                doserwera(tekst.value);
                poleczat.innerHTML += "ja: " + tekst.value + "\n";
                tekst.value = "";
            }

            function czat(event) {
                if (event.keyCode == 13) {
                    wyslij();
                }
            }
            
            function wyloguj() {
				window.location = "/logout";
			}

            function init() {
                var canvas = document.getElementById("mojCanvas");
                var wpisz = document.getElementById("wiadomosc");
                canvas.onmousedown = mousedown;
                canvas.onmousemove = mousemove;
                canvas.onmouseup = mouseup;
                wpisz.onkeyup = czat;

            }
        </script>
    </head>
    
    <body onLoad="init();">
        <div width="100" height="500" style="float:left">
            <form>
                <input type='text' id='kolor' list='kolory'>
                <datalist id='kolory'>
                    <option value="#000000">czarny</option>
                    <option value="#FF0000">czerwony</option>
                    <option value="#0000FF">niebieski</option>
                    <option value="#00FF00">zielony</option>
                    <option value="#FFFF00">żółty</option></datalist>
                </input>
                <input type='text' id='figura' list='figury'>
                <datalist id='figury'>
                    <option>prostokąt
                        <option>koło
                            <option>punkt
                                <option>linia</datalist>
            </form>
            <canvas id="mojCanvas" width="800" height="600" style="border:1px solid #000000;" />
        </div>
        <div width="1000" height="1000">
			<button onClick="wyloguj()" id="wyloguj">wyloguj sie</button><br />
            <textarea readonly name="czat" id="czat" cols="50" rows="20"></textarea>
            <br />
            <input type="text" id="wiadomosc" style="width: 420px" />
            <button onclick="wyslij()" />
        </div>
    </body>

</html>
